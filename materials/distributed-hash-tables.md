---
date: 2025-03-19
draft: false
status: Done
title: Ki·∫øn Tr√∫c v√† ·ª®ng D·ª•ng c·ªßa Distributed Hash Tables Trong M·∫°ng P2P
description: T√¨m hi·ªÉu c√°ch x√¢y d·ª±ng Distributed Hash Tables (DHTs) ‚Äì m·ªôt c∆° ch·∫ø ph√¢n ph·ªëi c∆° s·ªü d·ªØ li·ªáu (key, value) tr√™n h√†ng tri·ªáu peer. B√†i vi·∫øt gi·∫£i th√≠ch kh√°i ni·ªám, c√°ch thi·∫øt k·∫ø overlay v√≤ng tr√≤n, qu·∫£n l√Ω peer churn v√† ·ª©ng d·ª•ng trong BitTorrent üöÄ
author: PhDoanh
authorlink: https://github.com/PhDoanh
tags:
  - computer-networking
  - application-layer
  - web
  - p2p
  - hash-tables
aliases:
  - distributed hash tables
cssclasses:
  - img
  - btn
---
%% L∆ØU √ù 
- ƒê·ªãnh d·∫°ng t√™n file: "t√™n-b√†i-vi·∫øt" (jp-typing-guide, ...) 
%%

%% banner
<figure style="text-align: center; margin: 20px auto;">
  <img 
    src="images/distributed-hash-tables.png"
    alt="Distributed Hash Tables (DHTs): Ki·∫øn Tr√∫c v√† ·ª®ng D·ª•ng Trong M·∫°ng P2P  " 
    style="
      width: 90%;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    "
  >
  <figcaption style="
    font-style: italic;
    color: #666;
    margin-top: 10px;
    font-size: 1em;
    padding: 0 10px;
  ">
    <em>caption</em>
  </figcaption>
</figure>
 %%

---

Distributed Hash Tables (DHTs) l√† m·ªôt trong nh·ªØng c√¥ng ngh·ªá c·ªët l√µi gi√∫p x√¢y d·ª±ng c∆° s·ªü d·ªØ li·ªáu ph√¢n t√°n trong c√°c m·∫°ng P2P. Thay v√¨ l∆∞u tr·ªØ to√†n b·ªô d·ªØ li·ªáu tr√™n m·ªôt m√°y ch·ªß trung t√¢m, DHT cho ph√©p c√°c c·∫∑p **(key, value)** ƒë∆∞·ª£c ph√¢n t√°n tr√™n nhi·ªÅu peer, gi√∫p tƒÉng kh·∫£ nƒÉng m·ªü r·ªông v√† ƒë·ªô tin c·∫≠y c·ªßa h·ªá th·ªëng.

# Gi·ªõi thi·ªáu Distributed Hash Tables

Trong m·ªôt h·ªá th·ªëng P2P, m·ªói peer ch·ªâ l∆∞u tr·ªØ m·ªôt ph·∫ßn nh·ªè c·ªßa t·ªïng c∆° s·ªü d·ªØ li·ªáu. Khi m·ªôt peer mu·ªën tra c·ª©u ho·∫∑c th√™m m·ªõi m·ªôt c·∫∑p key-value, h·ªá th·ªëng DHT s·∫Ω ƒë·ªãnh v·ªã peer ch·ªãu tr√°ch nhi·ªám l∆∞u tr·ªØ c·∫∑p ƒë√≥.  

> [!info] L∆∞u √Ω
> DHT th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√¢y d·ª±ng c√°c d·ªãch v·ª• nh∆∞ **distributed trackers** trong BitTorrent, n∆°i m√† m·ªôt torrent identifier ƒë∆∞·ª£c √°nh x·∫° v·ªõi danh s√°ch IP c·ªßa c√°c peer.

**C∆° s·ªü d·ªØ li·ªáu ph√¢n t√°n** d√πng ƒë·ªÉ l∆∞u tr·ªØ v√† truy v·∫•n c√°c c·∫∑p (key, value) m·ªôt c√°ch ph√¢n t√°n tr√™n h√†ng tri·ªáu peer.

> [!example]- V√≠ d·ª•
> - **Key:** "Led Zeppelin IV" - T√™n c·ªßa n·ªôi dung  
> - **Value:** `128.17.123.38` - ƒê·ªãa ch·ªâ IP c·ªßa peer ch·ª©a n·ªôi dung ƒë√≥.

DHT s·ª≠ d·ª•ng h√†m bƒÉm (hash function) ƒë·ªÉ chuy·ªÉn ƒë·ªïi c√°c key kh√¥ng ph·∫£i s·ªë (nh∆∞ t√™n phim, s·ªë an sinh x√£ h·ªôi) th√†nh s·ªë nguy√™n trong kho·∫£ng $[0, 2^n - 1]$; v·ªõi $n$ l√† s·ªë bit d√πng ƒë·ªÉ bi·ªÉu di·ªÖn ƒë·ªãnh danh  

> [!example]- V√≠ d·ª•
> N·∫øu key ban ƒë·∫ßu l√† "Led Zeppelin IV", h√†m bƒÉm s·∫Ω cho ra m·ªôt s·ªë nguy√™n, t·ª´ ƒë√≥ DHT s·ª≠ d·ª•ng s·ªë ƒë√≥ ƒë·ªÉ ƒë·ªãnh v·ªã n∆°i l∆∞u tr·ªØ d·ªØ li·ªáu

# Ph√¢n ph·ªëi Key-Value trong DHT

H·ªá th·ªëng DHT s·ª≠ d·ª•ng m·ªôt **h√†m bƒÉm** ƒë·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠ l∆∞u tr·ªØ c·ªßa m·ªôt **key** tr√™n m·∫°ng P2P. Qu√° tr√¨nh n√†y g·ªìm c√°c b∆∞·ªõc:

1. **BƒÉm key**: M·ªôt key (v√≠ d·ª•: t√™n file, ID t√†i li·ªáu) ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh m·ªôt s·ªë nguy√™n b·∫±ng m·ªôt **h√†m bƒÉm** qua c√°c thu·∫≠t to√°n nh∆∞: SHA-1, SHA-256, ... S·ªë nguy√™n n√†y x√°c ƒë·ªãnh v·ªã tr√≠ c·ªßa key trong **kh√¥ng gian ƒë·ªãa ch·ªâ** c·ªßa DHT.

2. **X√°c ƒë·ªãnh peer ch·ªãu tr√°ch nhi·ªám l∆∞u tr·ªØ**: M·ªói peer trong h·ªá th·ªëng c≈©ng c√≥ m·ªôt ID duy nh·∫•t, ƒë∆∞·ª£c g√°n b·∫±ng c√πng m·ªôt h√†m bƒÉm. M·ªôt key s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i peer c√≥ **ID g·∫ßn nh·∫•t nh∆∞ng l·ªõn h∆°n ho·∫∑c b·∫±ng key** (g·ªçi l√† **"closest successor"**).

> [!example]- V√≠ d·ª•
> Gi·∫£ s·ª≠ ta c√≥ m·ªôt h·ªá th·ªëng DHT v·ªõi 6 peer, m·ªói peer c√≥ m·ªôt **ID** trong kho·∫£ng $[0,~15]$ (v·ªõi $n = 4$, t∆∞∆°ng ƒë∆∞∆°ng $2^4=16$ kh√¥ng gian ƒë·ªãa ch·ªâ t√≠nh t·ª´ 0 ƒë·∫øn 15):
> 
> | Peer | ID  |
> | ---- | --- |
> | P1   | 1   | 
> | P2   | 3   |
> | P3   | 6   |
> | P4   | 9   |
> | P5   | 12  |
> | P6   | 15  |
> 
> **B∆∞·ªõc 1: BƒÉm key ƒë·ªÉ x√°c ƒë·ªãnh n∆°i l∆∞u tr·ªØ**
> Gi·∫£ s·ª≠ ta mu·ªën l∆∞u file "data.txt", ta bƒÉm chu·ªói "data.txt" b·∫±ng h√†m SHA-1: hash("data.txt") = 10
> 
> **B∆∞·ªõc 2: X√°c ƒë·ªãnh peer n√†o l∆∞u tr·ªØ gi√° tr·ªã c·ªßa key = 10**
> - Nh√¨n v√†o danh s√°ch ID c·ªßa c√°c peer: 1, 3, 6, 9, 12, 15.
> - T√¨m peer c√≥ ID l·ªõn nh·∫•t nh∆∞ng g·∫ßn nh·∫•t v·ªõi 10.
> - Peer 12 (P5) l√† closest successor, n√™n file "data.txt" s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i P5.
>   
> Khi m·ªôt peer m·ªõi (P7) v·ªõi ID = 5 mu·ªën t√¨m file "data.txt":
> 1. **BƒÉm key** `"data.txt"` ƒë∆∞·ª£c **ID = 10**.
> 2. DHT b·∫Øt ƒë·∫ßu truy v·∫•n:
> 	- P7 ki·ªÉm tra danh s√°ch c√°c peer m√† n√≥ bi·∫øt, th·∫•y kh√¥ng c√≥ ID n√†o l√† 10.
> 	- P7 g·ª≠i truy v·∫•n ƒë·∫øn m·ªôt peer g·∫ßn nh·∫•t m√† n√≥ bi·∫øt c√≥ ID g·∫ßn v·ªõi 10 nh·∫•t, v√≠ d·ª•: P3 (ID = 6).
> 	- P3 ti·∫øp t·ª•c g·ª≠i truy v·∫•n ƒë·∫øn P4 (ID = 9).
> 	- P4 chuy·ªÉn ti·∫øp ƒë·∫øn P5 (ID = 12), l√† n∆°i ƒëang l∆∞u file "data.txt".
> 3. P5 tr·∫£ v·ªÅ d·ªØ li·ªáu cho P7.
>    
>  **L∆∞u √Ω**:
>  - H·ªá th·ªëng DHT n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø d∆∞·ªõi d·∫°ng v√≤ng n√™n 1 peer (P7) ch·ªâ c√≥ th·ªÉ bi·∫øt c√°c peer tr∆∞·ªõc (Peer c√≥ ID 4) v√† sau n√≥ (Peer c√≥ ID 5 l√† P3)
>  - N·∫øu h·ªá th·ªëng c√≥ **shortcuts** (ƒë∆∞·ªùng t·∫Øt), P7 c√≥ th·ªÉ bi·∫øt tr∆∞·ªõc P5 m√† kh√¥ng c·∫ßn ƒëi t·ª´ng b∆∞·ªõc qua P3, P4, gi√∫p gi·∫£m ƒë·ªô tr·ªÖ truy v·∫•n. H·ªá th·ªëng n√†y cho ph√©p P7 c√≥ b·∫£ng ƒë·ªãnh tuy·∫øn ƒë·∫ßy ƒë·ªß (b·∫£ng c√°c peer li√™n k·∫øt v·ªõi P7) 

**∆Øu ƒëi·ªÉm c·ªßa c√°ch ph√¢n ph·ªëi n√†y**:
- **T√≠nh m·ªü r·ªông:** M·ªói peer ch·ªâ c·∫ßn bi·∫øt th√¥ng tin c·ªßa m·ªôt s·ªë √≠t peer l√¢n c·∫≠n.
- **Gi·∫£m t·∫£i:** Kh√¥ng y√™u c·∫ßu m·ªói peer ph·∫£i l∆∞u tr·ªØ th√¥ng tin c·ªßa to√†n b·ªô h·ªá th·ªëng.

# Thi·∫øt k·∫ø s∆° ƒë·ªì m·∫°ng logic d·∫°ng v√≤ng tr√≤n

**C·∫•u tr√∫c m√¥ h√¨nh overlay:** C√°c peer ƒë∆∞·ª£c s·∫Øp x·∫øp th√†nh m·ªôt v√≤ng tr√≤n (circular overlay), v·ªõi m·ªói peer ch·ªâ bi·∫øt th√¥ng tin c·ªßa **ng∆∞·ªùi k·∫ø ti·∫øp** v√† **ng∆∞·ªùi ƒë·ª©ng tr∆∞·ªõc**.

> [!example]- V√≠ d·ª•
> - V·ªõi 8 peer c√≥ ƒë·ªãnh danh: 1, 3, 4, 5, 8, 10, 12, 15.
> - M·ªôt peer (v√≠ d·ª• peer 3) khi c·∫ßn t√¨m peer ch·ªãu tr√°ch nhi·ªám cho key 11 s·∫Ω g·ª≠i th√¥ng ƒëi·ªáp ƒëi theo chi·ªÅu kim ƒë·ªìng h·ªì cho ƒë·∫øn khi th√¥ng ƒëi·ªáp t·ªõi peer 12, x√°c ƒë·ªãnh r·∫±ng peer 12 l√† ng∆∞·ªùi "g·∫ßn nh·∫•t" v·ªõi key 11. ƒêi·ªÅu n√†y y√™u c·∫ßu peer g·ª≠i truy v·∫•n t·ªõi peer tr∆∞·ªõc n√≥ ho·∫∑c sau n√≥ mi·ªÖn l√† ID g·∫ßn v·ªõi key nh·∫•t 
  
**Gi·∫£i ph√°p m·ªü r·ªông - Th√™m "shortcuts"**
- **Shortcuts:** M·ªói peer c√≥ th·ªÉ l∆∞u th√™m th√¥ng tin c·ªßa m·ªôt s·ªë peer xa h∆°n trong v√≤ng tr√≤n. Gi√∫p **r√∫t ng·∫Øn s·ªë l∆∞·ª£ng th√¥ng ƒëi·ªáp** c·∫ßn chuy·ªÉn ti·∫øp ƒë·ªÉ ƒë·ªãnh v·ªã m·ªôt key.
- **L·ª£i √≠ch:** ƒê∆∞a s·ªë l∆∞·ª£ng th√¥ng ƒëi·ªáp trung b√¨nh v·ªÅ m·ª©c $O(\log N)$ thay v√¨ $O(N)$ trong m√¥ h√¨nh v√≤ng tr√≤n c∆° b·∫£n.

---

# Qu·∫£n l√Ω Peer Churn trong DHT
**Peer churn** x·∫£y ra khi c√°c peer tham gia ho·∫∑c r·ªùi kh·ªèi h·ªá th·ªëng m·ªôt c√°ch b·∫•t th∆∞·ªùng, khi·∫øn cho DHT ph·∫£i c·∫≠p nh·∫≠t th√¥ng tin k·ªãp th·ªùi ƒë·ªÉ duy tr√¨ t√≠nh nh·∫•t qu√°n c·ªßa h·ªá th·ªëng qua c√°c gi·∫£i ph√°p sau:

- **Theo d√µi li√™n t·ª•c:** M·ªói peer theo d√µi **ng∆∞·ªùi k·∫ø ti·∫øp** (successor) v√† **ng∆∞·ªùi ƒë·ª©ng tr∆∞·ªõc** (predecessor). ƒê√¥i khi, l∆∞u th√™m th√¥ng tin c·ªßa **ng∆∞·ªùi k·∫ø ti·∫øp th·ª© hai** ƒë·ªÉ d·ª± ph√≤ng.

- **C∆° ch·∫ø c·∫≠p nh·∫≠t:** Khi m·ªôt peer kh√¥ng ph·∫£n h·ªìi (v√≠ d·ª•, peer 5 r·ªùi kh·ªèi), c√°c peer l√¢n c·∫≠n s·∫Ω c·∫≠p nh·∫≠t th√¥ng tin c·ªßa m√¨nh ƒë·ªÉ k·∫øt n·ªëi v·ªõi peer m·ªõi. Qu√° tr√¨nh n√†y gi√∫p duy tr√¨ **overlay network** ·ªïn ƒë·ªãnh trong tr∆∞·ªùng h·ª£p c√≥ peer churn.

---

# ·ª®ng d·ª•ng DHT trong BitTorrent

- **BitTorrent s·ª≠ d·ª•ng DHT (v√≠ d·ª•: Kademlia DHT)** ƒë·ªÉ t·∫°o ra m·ªôt distributed tracker.
- **Quy tr√¨nh:**  
	- M·ªôt torrent identifier ƒë∆∞·ª£c bƒÉm th√†nh m·ªôt key.
	- DHT √°nh x·∫° key ƒë√≥ t·ªõi danh s√°ch IP c·ªßa c√°c peer ƒëang chia s·∫ª torrent.
	- M·ªôt peer m·ªõi c√≥ th·ªÉ truy v·∫•n DHT ƒë·ªÉ t√¨m ra c√°c peer ch·ª©a file c·∫ßn t·∫£i.

> [!info] L∆∞u √Ω
> Vi·ªác s·ª≠ d·ª•ng DHT trong BitTorrent gi√∫p lo·∫°i b·ªè s·ª± ph·ª• thu·ªôc v√†o c√°c tracker t·∫≠p trung, tƒÉng t√≠nh **phi t·∫≠p trung** v√† **ƒë·ªô tin c·∫≠y** c·ªßa h·ªá th·ªëng.

---

# C√°c c√¢u h·ªèi th∆∞·ªùng g·∫∑p

> [!caution]- N·ªôi dung ƒëang ho√†n thi·ªán
> Qu√° tr√¨nh x√¢y d·ª±ng n·ªôi dung n√†y c√≥ th·ªÉ m·∫•t nhi·ªÅu th·ªùi gian ‚åõ, nh∆∞ng b·∫°n c√≥ th·ªÉ th√∫c ƒë·∫©y n√≥ b·∫±ng c√°ch tham gia [[article-collaboration-guide|c·ªông t√°c b√†i vi·∫øt]] ü§ù
> 
> **R·∫•t mong s·ª± th√¥ng c·∫£m c·ªßa c√°c b·∫°n üôè**

---

# T·ªïng k·∫øt

Qua b√†i vi·∫øt n√†y, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu:
- **Distributed Hash Tables (DHTs)** l√† c∆° ch·∫ø ph√¢n ph·ªëi d·ªØ li·ªáu (key, value) tr√™n m·∫°ng P2P, s·ª≠ d·ª•ng h√†m bƒÉm ƒë·ªÉ chuy·ªÉn key th√†nh s·ªë nguy√™n.
- **Quy t·∫Øc ph√¢n ph·ªëi "closest successor"** gi√∫p ƒë·ªãnh v·ªã peer ch·ªãu tr√°ch nhi·ªám l∆∞u tr·ªØ m·ªôt key.
- **Overlay m·∫°ng d·∫°ng v√≤ng tr√≤n** gi√∫p gi·∫£m l∆∞·ª£ng th√¥ng tin m·ªói peer ph·∫£i l∆∞u tr·ªØ, v√† **shortcuts** c·∫£i thi·ªán hi·ªáu nƒÉng ƒë·ªãnh tuy·∫øn.
- **Qu·∫£n l√Ω Peer Churn** th√¥ng qua vi·ªác theo d√µi th√¥ng tin c·ªßa c√°c peer l√¢n c·∫≠n, ƒë·∫£m b·∫£o h·ªá th·ªëng lu√¥n ·ªïn ƒë·ªãnh.
- **·ª®ng d·ª•ng th·ª±c t·∫ø:** BitTorrent s·ª≠ d·ª•ng DHT ƒë·ªÉ qu·∫£n l√Ω torrent m·ªôt c√°ch ph√¢n t√°n, gi·∫£m ph·ª• thu·ªôc v√†o tracker t·∫≠p trung.

Nh·ªù v√†o DHT, c√°c h·ªá th·ªëng P2P c√≥ th·ªÉ **m·ªü r·ªông linh ho·∫°t** v√† **ph√¢n ph·ªëi d·ªØ li·ªáu hi·ªáu qu·∫£** ngay c·∫£ khi c√≥ h√†ng tri·ªáu peer tham gia. N·∫øu b·∫°n mu·ªën t√¨m hi·ªÉu s√¢u h∆°n, h√£y tham kh·∫£o c√°c b√†i vi·∫øt v√† nghi√™n c·ª©u v·ªÅ [Kademlia DHT](https://en.wikipedia.org/wiki/Kademlia) ho·∫∑c [Chord](https://en.wikipedia.org/wiki/Chord_(protocol)) ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt üöÄ.
